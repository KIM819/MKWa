<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>ãƒ¬ãƒ¼ã‚·ãƒ³ã‚°ã‚²ãƒ¼ãƒ  ãƒ‡ãƒ¼ã‚¿ãƒˆãƒ©ãƒƒã‚«ãƒ¼</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@1/css/pico.min.css">
   <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      font-family: 'Arial', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: rgba(255, 255, 255, 0.95);
      border-radius: 20px;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
      overflow: hidden;
    }
    .header {
      background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
      color: white;
      padding: 30px;
      text-align: center;
    }
    .header h1 {
      font-size: 2.5em;
      margin-bottom: 10px;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
    }
    .main-content {
      padding: 30px;
    }
    .section {
      background: white;
      border-radius: 15px;
      padding: 25px;
      margin-bottom: 25px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      border-left: 5px solid #4ecdc4;
    }
    h2 {
      color: #333;
      margin-bottom: 20px;
      font-size: 1.5em;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    label {
      display: block;
      margin-bottom: 8px;
      font-weight: bold;
      color: #555;
    }
    select, button, input {
      width: 100%;
      padding: 12px;
      margin-bottom: 15px;
      border: 2px solid #e0e0e0;
      border-radius: 10px;
      font-size: 1em;
    }
    button {
      background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
      color: white;
      border: none;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
    }
    .form-row {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
    }
    .form-col {
      flex: 1;
      min-width: 200px;
    }
    .record-list {
      white-space: pre-line;
      background: #f8f8f8;
      border-radius: 10px;
      padding: 15px;
      max-height: 300px;
      overflow-y: auto;
    }
    .hidden { display: none; }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>ğŸ® ãƒ¬ãƒ¼ã‚·ãƒ³ã‚°ã‚²ãƒ¼ãƒ  ãƒ‡ãƒ¼ã‚¿ãƒˆãƒ©ãƒƒã‚«ãƒ¼</h1>
      <p>ã‚³ãƒ¼ã‚¹ã¨é †ä½ã®è¨˜éŒ²ãƒ»åˆ†æãƒ„ãƒ¼ãƒ«</p>
    </div>

   <div class="main-content">
      <div class="section">
        <h2>ğŸ“ è¨˜éŒ²å…¥åŠ›</h2>
        <div class="form-row">
          <div class="form-col">
            <label>ãƒ¢ãƒ¼ãƒ‰é¸æŠ:</label>
            <select id="mode-select">
              <option value="A">Aãƒ¢ãƒ¼ãƒ‰</option>
              <option value="B">Bãƒ¢ãƒ¼ãƒ‰</option>
            </select>
          </div>
        </div>

        <div id="input-A" class="form-row">
          <div class="form-col">
            <label>ã‚³ãƒ¼ã‚¹:</label>
            <select id="a-course"></select>
          </div>
        </div>

        <div id="input-B" class="form-row hidden">
          <div class="form-col">
            <label>ã‚¹ã‚¿ãƒ¼ãƒˆ:</label>
            <select id="b-start"></select>
          </div>
          <div class="form-col">
            <label>ã‚´ãƒ¼ãƒ«:</label>
            <select id="b-goal"></select>
          </div>
        </div>

        <div class="form-row">
          <div class="form-col">
            <label>é †ä½:</label>
            <select id="rank"></select>
          </div>
          <div class="form-col">
            <label>&nbsp;</label>
            <button id="add-record">è¨˜éŒ²è¿½åŠ </button>
          </div>
          
        </div>
       

      </div>

      <div class="section">
  <h2>ğŸ“Š å¹³å‡é †ä½ç¢ºèª</h2>
  <div class="form-row">
    <div class="form-col">
      <label>ãƒ¢ãƒ¼ãƒ‰1:</label>
      <select class="avg-mode">
        <option value="A">Aãƒ¢ãƒ¼ãƒ‰</option>
        <option value="B">Bãƒ¢ãƒ¼ãƒ‰</option>
      </select>
      <select class="avg-a"></select>
      <select class="avg-b-start hidden"></select>
      <select class="avg-b-goal hidden"></select>
    </div>
    <div class="form-col">
      <label>ãƒ¢ãƒ¼ãƒ‰2:</label>
      <select class="avg-mode">
        <option value="A">Aãƒ¢ãƒ¼ãƒ‰</option>
        <option value="B">Bãƒ¢ãƒ¼ãƒ‰</option>
      </select>
      <select class="avg-a"></select>
      <select class="avg-b-start hidden"></select>
      <select class="avg-b-goal hidden"></select>
    </div>
    <div class="form-col">
      <label>ãƒ¢ãƒ¼ãƒ‰3:</label>
      <select class="avg-mode">
        <option value="A">Aãƒ¢ãƒ¼ãƒ‰</option>
        <option value="B">Bãƒ¢ãƒ¼ãƒ‰</option>
      </select>
      <select class="avg-a"></select>
      <select class="avg-b-start hidden"></select>
      <select class="avg-b-goal hidden"></select>
    </div>
  </div>
  <button id="check-average">å¹³å‡ã‚’ç¢ºèª</button>
  <pre id="average-section"></pre>
</div>

      </div>

      <div class="section">
        <h2>ğŸ“‹ è¨˜éŒ²ä¸€è¦§</h2>
        <div class="record-list" id="record-list"></div>
        <button id="clear-records">å…¨ã¦å‰Šé™¤</button>
      </div>

      <div class="section">
        <h2>ğŸ’¾ CSVå…¥å‡ºåŠ›</h2>
        <button id="export-csv">CSVå‡ºåŠ›</button>
        <input type="file" id="import-csv">
      </div>
    </div>
  </div>
<!-- ã“ã®HTMLã¯ã‚ãªãŸãŒé€ã£ã¦ãã‚ŒãŸã‚‚ã®ã¨åŒä¸€ã®æ§‹é€ ã§ã™ -->
<!-- ä»¥ä¸‹ã®JavaScriptã¯ãƒšãƒ¼ã‚¸æœ«å°¾ã«ãã®ã¾ã¾è¨˜è¿°ã—ã¦ä½¿ç”¨å¯èƒ½ã§ã™ -->
<script>
  const courses = {
    1: 'ã‚¢ã‚¤ã‚¹ãƒ“ãƒ«ãƒ‡ã‚£ãƒ³ã‚°', 2: 'ãƒ¯ãƒªã‚ªã‚·ãƒƒãƒ—', 3: 'ãƒ”ãƒ¼ãƒãƒ“ãƒ¼ãƒ', 4: 'ãƒ­ã‚¼ãƒƒã‚¿ã¦ã‚“ã‚‚ã‚“ã ã„', 5: 'DKã‚¹ãƒãƒ¼ãƒã‚¦ãƒ³ãƒ†ãƒ³',
    6: 'ã‚½ãƒ«ãƒ†ã‚£ãƒ¼ã‚¿ã‚¦ãƒ³', 7: 'ãƒãƒ†ãƒŠã—ã‚“ã§ã‚“', 8: 'ãŠã°ã‘ã‚·ãƒãƒ', 9: 'ã‚·ãƒ§ãƒ¼ãƒ‹ãƒ¥ãƒ¼ãƒ­ãƒ¼ãƒ‰', 10: 'ãƒ—ã‚¯ãƒ—ã‚¯ãƒ•ã‚©ãƒ¼ãƒ«ã‚º',
    11: 'ãƒªãƒãƒ¼ã‚µã‚¤ãƒ‰ã‚µãƒ•ã‚¡ãƒª', 12: 'ãƒ‡ã‚£ãƒãƒ‡ã‚£ãƒã‚¸ãƒ£ãƒ³ã‚°ãƒ«', 13: 'ã©ã‚“ãã‚Šãƒ„ãƒªãƒ¼ãƒã‚¦ã‚¹', 14: 'ãƒãƒªã‚ªã‚µãƒ¼ã‚­ãƒƒãƒˆ',
    15: 'ãƒ¢ãƒ¼ãƒ¢ãƒ¼ã‚«ãƒ³ãƒˆãƒªãƒ¼', 16: 'ãƒ”ãƒ¼ãƒã‚¹ã‚¿ã‚¸ã‚¢ãƒ ', 17: 'ãƒã‚³ãƒã‚³ãƒ“ãƒ¼ãƒ', 18: 'ãƒ›ãƒãƒ›ãƒãƒ„ã‚¤ã‚¹ã‚¿ãƒ¼', 19: 'ã‚­ãƒãƒ”ã‚ªãƒ•ã‚¡ã‚¯ãƒˆãƒªãƒ¼',
    20: 'ãƒãƒ§ã‚³ãƒã‚¦ãƒ³ãƒ†ãƒ³', 21: 'ãƒˆãƒ­ãƒ•ã‚£ãƒ¼ã‚·ãƒ†ã‚£', 22: 'DKã†ã¡ã‚…ã†ã‚»ãƒ³ã‚¿ãƒ¼', 23: 'ã‚¯ãƒƒãƒ‘ã‚­ãƒ£ãƒƒã‚¹ãƒ«', 24: 'ãƒ¯ãƒªã‚ªã‚¹ã‚¿ã‚¸ã‚¢ãƒ ',
    25: 'ãƒãƒªã‚ªãƒ–ãƒ©ã‚¶ãƒ¼ã‚ºã‚µãƒ¼ã‚­ãƒƒãƒˆ', 26: 'ã‚·ãƒ¥ãƒãƒã‚³ãƒ¼ã‚¹ã‚¿ãƒ¼', 27: 'ã‚­ãƒ©ãƒ¼ã‚·ãƒƒãƒ—', 28: 'ãƒ˜ã‚¤ãƒ›ãƒ¼ã‚«ãƒ¼ãƒ‹ãƒãƒ«',
    29: 'ã‚µãƒ³ã‚µãƒ³ã•ã°ã', 30: 'ãƒ¬ã‚¤ãƒ³ãƒœãƒ¼ãƒ­ãƒ¼ãƒ‰'
  };

  const connections = {
    1: [2,4,5,6,9], 2: [1,2,4,5,6,10], 3: [2,6,7,11], 4: [1,2,5,8,9,10,14],
    5: [1,2,4,6,9,10,15], 6: [2,3,5,7,10,11,12], 7: [3,6,11,12,17],
    8: [4,9,13,14,18], 9: [1,4,5,8,10,13,14,15,19], 10: [2,4,5,6,9,11,15,16],
    11: [6,7,10,12,16,17,21], 12: [6,7,11,17], 13: [8,9,14,18,19],
    14: [8,9,13,15,18,19,23], 15: [9,10,14,16,18,19,20],
    16: [10,11,15,17,19,20,21,30], 17: [11,12,16,21,22],
    18: [8,13,14,15,19,23,24,27], 19: [9,13,14,15,16,18,20,23,24,25,27],
    20: [15,16,19,21,23,24,25,26,28], 21: [11,15,16,17,20,22,24,25,26,29],
    22: [16,17,21,26], 23: [14,18,19,20,23,27], 24: [18,19,20,21,23,25,27,28],
    25: [19,20,21,24,26,28,29], 26: [20,21,22,25,29],
    27: [18,19,23,24,28], 28: [14,15,27,29], 29: [25,26,28], 30: []
  };

  const getEl = id => document.getElementById(id);
  const getAll = sel => document.querySelectorAll(sel);

  const modeSelect = getEl('mode-select');
  const inputA = getEl('input-A');
  const inputB = getEl('input-B');
  const aCourse = getEl('a-course');
  const bStart = getEl('b-start');
  const bGoal = getEl('b-goal');
  const rank = getEl('rank');
  const recordList = getEl('record-list');
  const averageSection = getEl('average-section');

  const avgModeEls = getAll('.avg-mode');
  const avgAEls = getAll('.avg-a');
  const avgStartEls = getAll('.avg-b-start');
  const avgGoalEls = getAll('.avg-b-goal');

  for (let i = 1; i <= 30; i++) {
    const opt = new Option(`${i} ${courses[i]}`, i);
    aCourse.add(opt.cloneNode(true));
    bStart.add(opt.cloneNode(true));
    avgAEls.forEach(sel => sel.add(opt.cloneNode(true)));
    avgStartEls.forEach(sel => sel.add(opt.cloneNode(true)));
  }

  for (let i = 1; i <= 24; i++) {
    rank.add(new Option(`${i}ä½`, i));
  }

  bStart.addEventListener('change', () => {
    bGoal.innerHTML = '';
    (connections[+bStart.value] || []).forEach(n => bGoal.add(new Option(`${n} ${courses[n]}`, n)));
  });

  modeSelect.addEventListener('change', () => {
    const mode = modeSelect.value;
    inputA.classList.toggle('hidden', mode !== 'A');
    inputB.classList.toggle('hidden', mode !== 'B');
  });

  avgModeEls.forEach((el, i) => {
    el.innerHTML = '<option value="A">Aãƒ¢ãƒ¼ãƒ‰</option><option value="B">Bãƒ¢ãƒ¼ãƒ‰</option>';
    el.addEventListener('change', () => {
      const isA = el.value === 'A';
      avgAEls[i].classList.toggle('hidden', !isA);
      avgStartEls[i].classList.toggle('hidden', isA);
      avgGoalEls[i].classList.toggle('hidden', isA);
    });
  });

  avgStartEls.forEach((startSel, i) => {
    startSel.addEventListener('change', () => {
      const val = +startSel.value;
      const goalSel = avgGoalEls[i];
      goalSel.innerHTML = '';
      (connections[val] || []).forEach(id => goalSel.add(new Option(`${id} ${courses[id]}`, id)));
    });
  });

  function getRecords() {
    return JSON.parse(localStorage.getItem('raceRecords') || '[]');
  }

  function saveRecords(records) {
    localStorage.setItem('raceRecords', JSON.stringify(records));
  }

  function displayRecords() {
    const records = getRecords();
    recordList.innerHTML = records.map((r, i) => {
      const label = r.mode === 'A' ? `${courses[r.course]}` : `${courses[r.start]} â†’ ${courses[r.goal]}`;
      return `[${records.length - i}]
${r.mode}ãƒ¢ãƒ¼ãƒ‰
${label}
${r.rank}ä½\n`;
    }).join('\n');
  }

  function calcAverage(filters) {
    const records = getRecords();
    return filters.map(f => {
      const relevant = records.filter(r =>
        f.mode === 'A'
          ? r.mode === 'A' && r.course == f.course
          : r.mode === 'B' && r.start == f.start && r.goal == f.goal
      );
      const avg = relevant.length ? (relevant.reduce((sum, r) => sum + +r.rank, 0) / relevant.length).toFixed(2) : '-';
      return `${f.mode}ãƒ¢ãƒ¼ãƒ‰\n${f.mode === 'A' ? courses[f.course] : `${courses[f.start]} â†’ ${courses[f.goal]}`}\nå¹³å‡é †ä½: ${avg}`;
    });
  }

  function updateAverageSection() {
    const filters = [];
    for (let i = 0; i < 3; i++) {
      const mode = avgModeEls[i].value;
      if (mode === 'A' && avgAEls[i].value) {
        filters.push({ mode: 'A', course: avgAEls[i].value });
      } else if (mode === 'B' && avgStartEls[i].value && avgGoalEls[i].value) {
        filters.push({ mode: 'B', start: avgStartEls[i].value, goal: avgGoalEls[i].value });
      }
    }
    const allA = getRecords().filter(r => r.mode === 'A');
    const excluded = filters.filter(f => f.mode === 'A').map(f => f.course);
    const remainA = allA.filter(r => !excluded.includes(r.course));
    const avg = remainA.length ? (remainA.reduce((s, r) => s + +r.rank, 0) / remainA.length).toFixed(2) : '-';
    const out = [...calcAverage(filters), `ãŠã¾ã‹ã›\nå¹³å‡é †ä½: ${avg}`];
    averageSection.innerText = out.join('\n\n');
  }

  getEl('add-record').addEventListener('click', () => {
    const mode = modeSelect.value;
    const newRec = mode === 'A'
      ? { mode: 'A', course: aCourse.value, rank: rank.value }
      : { mode: 'B', start: bStart.value, goal: bGoal.value, rank: rank.value };
    const updated = [newRec, ...getRecords()];
    saveRecords(updated);
    displayRecords();
    updateAverageSection();
  });

  getEl('check-average').addEventListener('click', updateAverageSection);

  getEl('clear-records').addEventListener('click', () => {
    if (confirm('å…¨ã¦ã®è¨˜éŒ²ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) {
      localStorage.removeItem('raceRecords');
      displayRecords();
      updateAverageSection();
    }
  });

  getEl('export-csv').addEventListener('click', () => {
    const records = getRecords();
    const csv = records.map(r => r.mode === 'A'
      ? `A,${r.course},,${r.rank}`
      : `B,${r.start},${r.goal},${r.rank}`).join('\n');
    const blob = new Blob([csv], { type: 'text/csv' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'records.csv';
    a.click();
    URL.revokeObjectURL(url);
  });

  getEl('import-csv').addEventListener('change', e => {
    const file = e.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = () => {
      const lines = reader.result.trim().split(/\r?\n/);
      const newRecords = lines.map(l => {
        const [mode, a, b, rank] = l.split(',');
        return mode === 'A'
          ? { mode, course: a, rank }
          : { mode, start: a, goal: b, rank };
      });
      const combined = [...newRecords, ...getRecords()];
      saveRecords(combined);
      displayRecords();
      updateAverageSection();
    };
    reader.readAsText(file);
  });

  displayRecords();
  updateAverageSection();
</script>
